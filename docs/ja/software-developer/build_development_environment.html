<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <!-- default template -->
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <link rel="icon" href="/images/favicon.ico" type="image/x-icon"/>
  <title>build_development_environment</title>
  <script type="text/javascript">
      var path = location.pathname.split('/');
      var pathRoot = [ path[0], path[1], '' ].join('/');
      var pathLang = [ path[0], path[1], path[2] , ''].join('/');

      document.write('<link rel="stylesheet" href="' + pathRoot + 'personium.css" type="text/css" />');
      document.write('<link rel="stylesheet" href="' + pathLang + 'locale.css" type="text/css" />');
      var ps = document.createElement('script');
      ps.src = pathRoot + 'personium_docs.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ps, s);
    
      ps2 = document.createElement('script');
      ps2.src = pathRoot + 'apiref_versions.js';
      s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ps2, s);
  </script>
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
  <header>
    <nav>
    <div id="logo"><a href="/"><img src="https://personium.io/images/logo-quantify-dark.png"></a></div>
    <ul>
      <li class="submenu">
        <a href="#" >Introduction</a>
        <ul>
            <li><a href="javascript:p.toPage('/overview/001_Introduction.html');">What's Personium?</a></li>
            <li><a href="javascript:p.toPage('/user_guide/001_Personium_Architecture.html');">Architecture</a></li>
            <li><a href="javascript:p.toPage('/user_guide/008_Glossary.html');">Glossary</a></li>
        </ul>
      </li>
      <li class="submenu">
        <a href="#" >User Guide</a>
        <ul>
            <li><a href="javascript:p.toPage('/app-developer/');">for App Developer</a></li>
            <li><a href="javascript:p.toPage('/cell-gui-developer/');">for Cell GUI Developer</a></li>
            <li><a href="javascript:p.toPage('/unit-administrator/');">for Unit Administrator</a></li>
            <li><a href="javascript:p.toPage('/server-operator/');">for Server Software Operator</a></li>
            <li><a href="javascript:p.toPage('/document-writer/');">for Documentation Contributor</a></li>
            <li><a href="javascript:p.toPage('/plugin-developer/');">for Server Plugin Developer</a></li>
            <li><a href="javascript:p.toPage('/software-developer/');">for Server Developer</a></li>
        </ul>
      </li>
      <li class="submenu">
        <a href="#" >API Reference</a>
        <ul id="api-ref-list">
            <li><a href="javascript:p.toPage('/user_guide/990_Old_Version_API_Ref.html');">older versions</a></li>
        </ul>
      </li>
      <li class="submenu">
        <a href="#" >Languages</a>
        <ul>
            <li><a href="javascript:p.setLang('en');">English</a></li>
            <li><a href="javascript:p.setLang('ja');">Japanese</a></li>
        </ul>
      </li>
    </ul>
    </nav>
  </header>

<div id="container">
<h1>開発用環境の構築手順</h1>
<h2>対象OS</h2>
<p>Windows</p>
<h2>開発に必要なツール一覧</h2>
<p>開発に必要なツールをダウンロードしてください。</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">ツール名</th>
<th style="text-align: left;">バージョン</th>
<th style="text-align: left;">ダウンロードURL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Eclipse (Pleiades)</td>
<td style="text-align: left;">2018-09 Full Edition 以降</td>
<td style="text-align: left;"><a href="http://mergedoc.osdn.jp/" class="uri">http://mergedoc.osdn.jp/</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">AdoptOpenJDK</td>
<td style="text-align: left;">8系 / HotSpot</td>
<td style="text-align: left;"><a href="https://adoptopenjdk.net/" class="uri">https://adoptopenjdk.net/</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Git</td>
<td style="text-align: left;">最新</td>
<td style="text-align: left;"><a href="https://git-scm.com/" class="uri">https://git-scm.com/</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">Maven</td>
<td style="text-align: left;">3系</td>
<td style="text-align: left;"><a href="https://maven.apache.org/download.cgi" class="uri">https://maven.apache.org/download.cgi</a></td>
</tr>
</tbody>
</table>
<h2>動作確認に必要なツール一覧</h2>
<p>動作確認に必要なツールをダウンロードしてください。</p>
<table style="width:17%;">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">ツール名</th>
<th style="text-align: left;">バージョン</th>
<th style="text-align: left;">ダウンロードURL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Tomcat</td>
<td style="text-align: left;">9.0系</td>
<td style="text-align: left;">Pleiades同梱のものを使用するため個別の導入は行わない</td>
</tr>
<tr class="even">
<td style="text-align: left;">Elasticsearch</td>
<td style="text-align: left;">6.6.1</td>
<td style="text-align: left;"><a href="https://www.elastic.co/jp/downloads/past-releases/elasticsearch-6-6-1" class="uri">https://www.elastic.co/jp/downloads/past-releases/elasticsearch-6-6-1</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ActiveMQ</td>
<td style="text-align: left;">5.15系</td>
<td style="text-align: left;"><a href="http://activemq.apache.org/download-archives.html" class="uri">http://activemq.apache.org/download-archives.html</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">Nginx</td>
<td style="text-align: left;">1.14系</td>
<td style="text-align: left;"><a href="http://nginx.org/download/nginx-1.14.0.zip" class="uri">http://nginx.org/download/nginx-1.14.0.zip</a></td>
</tr>
</tbody>
</table>
<h2>各種ツールの初期設定</h2>
<h3>Eclipse</h3>
<ol>
<li><p>[Window]-&gt;[設定]からインストール済のJREにAdoptOpenJDKを追加します。<br />
追加したAdoptOpenJDKをデフォルトに設定します。</p></li>
<li><p>[Window]-&gt;[設定]からサーバー・ランタイム環境にTomcat9のサーバを追加します。<br />
サーバのJREにはAdoptOpenJDKを設定します。</p></li>
</ol>
<h3>JDK</h3>
<p>環境変数(JAVA_HOME)を設定します。</p>
<pre><code>変数：JAVA_HOME
値：javaのインストールディレクトリパス(例：C:\Program Files\Java\openjdk-1.8.0.191)</code></pre>
<p>システム環境変数Pathに以下を追加します。</p>
<pre><code>%JAVA_HOME%\bin</code></pre>
<h3>Git</h3>
<p>C:¥Users¥[user]¥.gitconfigに、以下の記述を追加します。</p>
<pre><code>[core]
    autocrlf = false
    ignorecase = false</code></pre>
<blockquote>
<p>プロキシ環境下に開発環境を構築する場合、以下も追記します。<br />
※{}の値はユーザ自身の情報を入力します。</p>
</blockquote>
<pre><code>[http]
    proxy = {protocol}://{username}:{pass}@{host}:{port}
[https]
    proxy = {protocol}://{username}:{pass}@{host}:{port}</code></pre>
<h3>Maven</h3>
<p>環境変数(M2_HOME)を設定します。</p>
<pre><code>変数：M2_HOME
値：mavenのインストールディレクトリパス（例：C:\Program Files\apache-maven-3.5.4）</code></pre>
<p>システム環境変数Pathに以下を追加します。</p>
<pre><code>%M2_HOME%\bin</code></pre>
<blockquote>
<p>プロキシ環境下に開発環境を構築する場合、apache-maven-3.5.4\conf\settings.xmlに以下の記述を追加します。<br />
※{}の値はユーザ自身の情報を入力します。</p>
</blockquote>
<pre><code>&lt;proxies&gt;
  &lt;proxy&gt;
      &lt;id&gt;proxy00&lt;/id&gt;
      &lt;active&gt;true&lt;/active&gt;
      &lt;protocol&gt;http&lt;/protocol&gt;
      &lt;username&gt;{username}&lt;/username&gt;
      &lt;password&gt;{pass}&lt;/password&gt;
      &lt;host&gt;{host}&lt;/host&gt;
      &lt;port&gt;{port}&lt;/port&gt;
      &lt;nonProxyHosts&gt;local.net|some.host.com&lt;/nonProxyHosts&gt;
  &lt;/proxy&gt;
  &lt;proxy&gt;
      &lt;id&gt;proxy01&lt;/id&gt;
      &lt;active&gt;true&lt;/active&gt;
      &lt;protocol&gt;https&lt;/protocol&gt;
      &lt;username&gt;{username}&lt;/username&gt;
      &lt;password&gt;{pass}&lt;/password&gt;
      &lt;host&gt;{host}&lt;/host&gt;
      &lt;port&gt;{port}&lt;/port&gt;
      &lt;nonProxyHosts&gt;local.net|some.host.com&lt;/nonProxyHosts&gt;
  &lt;/proxy&gt;
&lt;/proxies&gt;</code></pre>
<h3>Elasticsearch</h3>
<h4>elasticsearch-6.6.1\config\elasticsearch.ymlの修正</h4>
<p>elasticsearch.ymlに以下の記述を追加します。</p>
<pre><code>cluster.name: 【任意の名前】

network.host: 0.0.0.0
action.auto_create_index: &quot;.watches,.triggered_watches,.watcher-history-*&quot;
http.cors.enabled: true
http.cors.allow-origin: &quot;*&quot;
indices.fielddata.cache.size: 80%（任意:ヒープメモリの何％をデータキャッシュとして使用するか）</code></pre>
<h3>ActiveMQ</h3>
<p>特になし</p>
<h3>Tomcat</h3>
<p>特になし</p>
<h3>Nginx</h3>
<p>Nginxの初期設定のため、nginx-1.14.0\conf配下のnginx.confファイルを修正します。</p>
<ol>
<li><p>httpの中に以下記述を追加します。</p>
<pre><code>    ignore_invalid_headers on;
    proxy_set_header Host $http_host;
    proxy_http_version 1.1;
    large_client_header_buffers 4 55k;

    map $http_upgrade $connection_upgrade {
      default upgrade;
      &#39;&#39; close;
    }</code></pre></li>
<li><p>http.server.location /の内容を以下記述に変更します。</p>
<pre><code>            #root   html;
            #index  index.html index.htm;

            if ($request_uri ~ [\x00-\x20\x22\x3c\x3e\x5b-\x5e\x60\x7b-\x7d\x7f]) {
                return 400;
            }

            if ($request_uri ~* ([^?]+)\?(.*)) {
              set $personium_path $1;
              rewrite .* /personium-core$personium_path break;
            }
            if ($is_args = &quot;&quot;) {
              rewrite .* /personium-core$request_uri break;
            }

            proxy_pass http://localhost:8080;
            proxy_set_header X-Forwarded-For $remote_addr;
            proxy_set_header X-Forwarded-Proto http;
            proxy_set_header X-Forwarded-Path $request_uri;
            proxy_set_header Host $http_host;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection $connection_upgrade;
            proxy_hide_header X-Powered-By;
            proxy_hide_header X-Rack-Cache;
            proxy_hide_header X-Content-Digest;
            proxy_hide_header X-Runtime;</code></pre></li>
</ol>
<h2>Eclipseへのプロジェクトインポート</h2>
<p>personium-coreとpersonium-engineをプロジェクトとしてインポートします。</p>
<ol>
<li><p>GitHubのリポジトリからcloneします。<br />
<a href="https://github.com/personium/personium-core.git" class="uri">https://github.com/personium/personium-core.git</a><br />
<a href="https://github.com/personium/personium-engine.git" class="uri">https://github.com/personium/personium-engine.git</a></p></li>
<li><p>Eclipseのmavenプロジェクトとしてそれぞれをインポートします。</p></li>
<li><p>それぞれの/src/main/resourcesにpersonium-unit-config.propertiesを作成します。</p>
<blockquote>
<p>io.personium.core.es.cluster.nameの値はElasticsearchのconfigファイル（elasticsearch.yml）<br />
のcluster.nameで設定した値を指定します。</p>
</blockquote></li>
</ol>
<p><strong>/personium_core/src/main/resources/personium-unit-config.properties</strong></p>
<pre><code>#################################################
# personium-core configurations
#################################################
# general configurations
io.personium.core.masterToken=personiumio
io.personium.core.unitScheme=http
#io.personium.core.unitPort=9998
#io.personium.core.unitPort=8080
io.personium.core.unitPort=
#io.personium.core.unitPath=/personium-core
io.personium.core.unitPath=
io.personium.core.pathBasedCellUrl.enabled=true

io.personium.core.unitUser.issuers=personium-localunit:/unitadmin/ personium-localunit:/unitadmincell/ personium-localunit:/unitusercell/

# cell configurations
io.personium.core.cell.relayhtmlurl.default=https://app-cc-home.demo.personium.io/__/index.html

io.personium.core.es.cluster.name=【elasticsearch.ymlで設定した値】
io.personium.core.es.retryTimes=10

io.personium.core.plugin.path=/personium/plugins
io.personium.core.blobStore.root=/personium_nfs/personium-core/dav
io.personium.core.bar.tmp.dir=/personium_nfs/personium-core/bar
io.personium.core.event.log.current.dir=/personium_nfs/personium-core/eventlog
io.personium.core.cellSnapshot.root=/personium_nfs/personium-core/snapshot

# lock type configurations
io.personium.core.lock.type=inProcess

# cache configurations (memcached protocol)
io.personium.core.cache.type=inProcess
io.personium.core.cache.cell.enabled=false
io.personium.core.cache.box.enabled=false
io.personium.core.cache.schema.enabled=false

# security configurations
io.personium.core.security.secret16=gv7hpmmf5siwj5by
io.personium.core.security.auth.password.salt=voAbizvF
io.personium.core.security.dav.encrypt.enabled=false

# Davlimit configurations
io.personium.core.dav.childresource.maxnum=30
io.personium.core.dav.depth.maxnum=5

# OData $links configurations
io.personium.core.odata.links.NtoN.maxnum=40</code></pre>
<p><strong>/personium_engine/src/main/resources/personium-unit-config.properties</strong></p>
<pre><code>#################################################
# personium-engine configurations
#################################################
# general configurations
io.personium.core.masterToken=personiumio

io.personium.core.blobStore.root=/personium_nfs/personium-core/dav

# security configurations
io.personium.core.security.secret16=secret167pm5m4y6</code></pre>
<p>※各設定の説明は<a href="../server-operator/unit_config_list.html">Unitの設定一覧</a>を参照してください。</p>
<blockquote>
<p>※Eclipse上でmavenやpom.xml関連のビルドエラーが出ている場合、<br />
以下に記載した手順を実施してください。</p>
</blockquote>
<ol>
<li><p>コマンドプロンプト等でpom.xmlが存在するディレクトリに移動します。</p></li>
<li><p>以下のコマンドを実行します。</p>
<pre><code>mvn clean package -DskipTests</code></pre>
<p>コマンドがSUCCESSで終了しなかった場合は原因を取り除いて再度実施します。</p></li>
<li><p>Eclipse上で対象プロジェクトを右クリック→[Maven]→[プロジェクトの更新]→[OK]を選択します。</p></li>
</ol>
<h2>起動確認方法</h2>
<p>コマンドは管理者権限を持つユーザで実行してください。</p>
<h3>1. Elasticsearch起動確認</h3>
<p>コマンドプロンプト等でElasticsearchのインストールディレクトリに移動します。</p>
<pre><code>&gt; cd Elasticsearchインストールディレクトリ</code></pre>
<p>以下コマンドを実行します。</p>
<pre><code>&gt; bin\elasticsearch-service install (初回のみ)
&gt; bin\elasticsearch-service start</code></pre>
<p>ブラウザでhttp://localhost:9200にアクセスします。</p>
<p>以下のように出力されると起動成功となります。</p>
<pre><code>{
  &quot;name&quot; : &quot;MODAM&quot;,
  &quot;cluster_name&quot; : &quot;【elasticsearch.ymlで設定した値】&quot;,
  &quot;cluster_uuid&quot; : &quot;VM2fJ2hXQRSI4PsYhJBtLA&quot;,
  &quot;version&quot; : {
    &quot;number&quot; : &quot;6.6.1&quot;,
    &quot;build_flavor&quot; : &quot;default&quot;,
    &quot;build_type&quot; : &quot;zip&quot;,
    &quot;build_hash&quot; : &quot;1fd8f69&quot;,
    &quot;build_date&quot; : &quot;2019-02-13T17:10:04.160291Z&quot;,
    &quot;build_snapshot&quot; : false,
    &quot;lucene_version&quot; : &quot;7.6.0&quot;,
    &quot;minimum_wire_compatibility_version&quot; : &quot;5.6.0&quot;,
    &quot;minimum_index_compatibility_version&quot; : &quot;5.0.0&quot;
  },
  &quot;tagline&quot; : &quot;You Know, for Search&quot;
}</code></pre>
<h3>2. ActiveMQ起動確認</h3>
<p>コマンドプロンプト等でActivemqのインストールディレクトリに移動します。</p>
<pre><code>&gt; cd Activemqインストールディレクトリ</code></pre>
<p>以下コマンドを実行します。</p>
<pre><code>&gt; bin\activemq start</code></pre>
<p>ブラウザでhttp://localhost:8161にアクセスします。<br />
管理画面が表示されると起動成功となります。</p>
<h3>3. 開発用サーバ起動確認</h3>
<p>Eclipse上で[personium-core]プロジェクトを右クリック→[実行]→[サーバで実行]を選択します。</p>
<p>サーバは初期設定で追加したTomcat9のサーバを選択して実行します。</p>
<blockquote>
<p>※Tomcat9の起動でタイムアウト時間を超えて起動エラーになることがあります。<br />
EclipseでTomcat起動時のタイムアウト時間を変更してください。</p>
</blockquote>
<p>ブラウザでhttp://localhost:8080/personium-core/にアクセスします。<br />
以下のように出力されると起動成功となります。</p>
<pre><code>{&quot;unit&quot;:{&quot;path_based_cellurl_enabled&quot;:true,&quot;url&quot;:&quot;http:\/\/localhost\/&quot;}}</code></pre>
<h3>4. Nginx起動確認</h3>
<p>コマンドプロンプト等でNginxインストールディレクトリに移動します。</p>
<pre><code>&gt; cd Nginxインストールディレクトリ</code></pre>
<p>以下のコマンドを実行します。</p>
<pre><code>&gt; start nginx</code></pre>
<p>ブラウザでhttp://localhostにアクセスします。<br />
以下のように出力されると起動成功となります。</p>
<pre><code>{&quot;unit&quot;:{&quot;path_based_cellurl_enabled&quot;:true,&quot;url&quot;:&quot;http:\/\/localhost\/&quot;}}</code></pre>
</div>
  <footer><nav>The Personium project is provided under the Apache 2.0 license. </nav></footer>
</body>
</html>

