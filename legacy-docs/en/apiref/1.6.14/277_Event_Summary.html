<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <!-- default template -->
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>277_Event_Summary</title>
  <script type="text/javascript">
      var path = location.pathname.split('/');
      var pathRoot = [ path[0], path[1], '' ].join('/');
      var pathLang = [ path[0], path[1], path[2] , ''].join('/');

      //load style sheets
      document.write('<link rel="stylesheet" href="' + pathRoot + 'personium.css" type="text/css" />');
      document.write('<link rel="stylesheet" href="' + pathLang + 'locale.css" type="text/css" />');
      //load personium_docs.js
      var ps = document.createElement('script');
      ps.src = pathRoot + 'personium_docs.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ps, s);
    
      //load apiref_versions.js
      ps2 = document.createElement('script');
      ps2.src = pathRoot + 'apiref_versions.js';
      s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ps2, s);

  </script>
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
  <header>
    <nav>
    <div id="logo"><a href="/">Personium</a></div>
    <ul>
      <li class="submenu">
        <a href="" >Introduction</a>
        <ul>
            <li><a href="javascript:p.toPage('/overview/001_Introduction.html');">What's Personium?</a></li>
            <li><a href="javascript:p.toPage('/user_guide/001_Personium_Architecture.html');">Architecture</a></li>
            <li><a href="javascript:p.toPage('/user_guide/008_Glossary.html');">Glossary</a></li>
        </ul>
      </li>
      <li class="submenu">
        <a href="" >User Guide</a>
        <ul>
            <li><a href="javascript:p.toPage('/app-developer/');">for App Developer</a></li>
            <li><a href="javascript:p.toPage('/cell-client-developer/');">for Cell App Developer</a></li>
            <li><a href="javascript:p.toPage('/unit-administrator/');">for Unit Administrator</a></li>
            <li><a href="javascript:p.toPage('/server-operator/');">for Server Software Operator</a></li>
            <li><a href="javascript:p.toPage('/document-writer/');">for Documentation Contributor</a></li>
            <li><a href="javascript:p.toPage('/plugin-developer/');">for Server Plugin Developer</a></li>
            <li><a href="javascript:p.toPage('/software-developer/');">for Server Developer</a></li>
        </ul>
      </li>
      <li class="submenu">
        <a href="" >API Reference</a>
        <ul id="api-ref-list">
            <li><a href="javascript:p.toPage('/user_guide/990_Old_Version_API_Ref.html');">older versions</a></li>
        </ul>
      </li>
      <li class="submenu">
        <a href="" >Languages</a>
        <ul>
            <li><a href="javascript:p.setLang('en');">English</a></li>
            <li><a href="javascript:p.setLang('ja');">Japanese</a></li>
        </ul>
      </li>
    </ul>
    </nav>
  </header>

<div id="container">
<h1>Event model</h1>
<h2>Overview</h2>
<p>It consists of an external event defined by <a href="278_Event_Reception.html">event reception API</a> and an internal event defined within Personium.</p>
<p><img src="image/eventmodel.png" title="event model" alt="Event model" /></p>
<h4>External event</h4>
<p>Represents an event to be accepted in <a href="278_Event_Reception.html">Event reception API</a>. An event is generated by the event reception API, and the accepted event is output to the event bus. In the future, it will be possible to relay the reception of events to other cells. In case</p>
<h4>Internal Event</h4>
<p>Indicates processing that is executed based on the state of management data (OData / WebDAV / Service, etc.) held inside Personium. As a typical internal event, there is a request of Personium API. When the response of the Personium API is returned, the execution result is output as an event to the event bus.</p>
<h2>Event Format</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Item Name</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Subject</td>
<td style="text-align: left;">It is set from token of Authorization header</td>
</tr>
<tr class="even">
<td style="text-align: left;">Schema</td>
<td style="text-align: left;">It is set from token of Authorization header</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RequestKey</td>
<td style="text-align: left;">It is set from X-Personium-RequestKey header</td>
</tr>
<tr class="even">
<td style="text-align: left;">External</td>
<td style="text-align: left;">Flag indicating whether the event is an external event</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Type</td>
<td style="text-align: left;">Type of the event</td>
</tr>
<tr class="even">
<td style="text-align: left;">Object</td>
<td style="text-align: left;">Object of the event</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Info</td>
<td style="text-align: left;">Information of the event</td>
</tr>
</tbody>
</table>
<h3>Internal Event Definitions</h3>
<p>Type value is defined for each operation. Type value is normalized. Examples of normalization are below.</p>
<table style="width:11%;">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Before</th>
<th style="text-align: left;">After normalization</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">cellctl.Role.links.Box.create</td>
<td style="text-align: left;">cellctl.Box.links.Role.create</td>
</tr>
<tr class="even">
<td style="text-align: left;">cellctl.Relation.links.ExtCell.delete</td>
<td style="text-align: left;">cellctl.ExtCell.links.Relation.delete</td>
</tr>
</tbody>
</table>
<p>Object value basically is set to a URL or a URL with key string. URL is URL with personium-localcell scheme, URL with key string is URL that append key of result of create operation. For example, when entity of __id='0123' is created, request url and URL with key string are as follows:</p>
<table style="width:11%;">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">request url</th>
<th style="text-align: left;">URL with key string</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">http://personium/cell/box/col/entity</td>
<td style="text-align: left;">personium-localcell:/box/col/entity('0123')</td>
</tr>
</tbody>
</table>
<p>Key string set to Object is normalized. Examples of normalization are below.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Before</th>
<th style="text-align: left;">After normalization</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Role(’role’)</td>
<td style="text-align: left;">Role(Name=’role’, _Box.Name=null)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Role(_Box.Name=null, Name=’role’)</td>
<td style="text-align: left;">Role(Name=’role’, _Box.Name=null)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Account(Name=’hoge’)</td>
<td style="text-align: left;">Account(’hoge’)</td>
</tr>
</tbody>
</table>
<p>Info value basically is set to response code and request url. Request url is exact url in Rest API call and includes arguments. In update operation, Info is set to updated key string. The key string is used for accessing to updated object.</p>
<table style="width:17%;">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Object</th>
<th style="text-align: left;">Info</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">celctl.Role.update</td>
<td style="text-align: left;">personium-localcell:/__ctl/Role(Name='role1', _Box.Name=null)</td>
<td style="text-align: left;">204,(Name='role2', _Box.Name=null)</td>
</tr>
</tbody>
</table>
<p>Request URL to updated Role object:</p>
<pre><code>http://{FQDN}/{CellName}/__ctl/Role(Name=&#39;role2&#39;, _Box.Name=null)</code></pre>
<h4>Cell Level API</h4>
<h5>Cell Control Object</h5>
<table style="width:33%;">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Operations</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Object</th>
<th style="text-align: left;">Info</th>
<th style="text-align: left;">Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Basic Operations</td>
<td style="text-align: left;">Create</td>
<td style="text-align: left;">cellctl.xxx.create</td>
<td style="text-align: left;">URL with key string</td>
<td style="text-align: left;">201,Request URL</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Retrieve</td>
<td style="text-align: left;">cellctl.xxx.get</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">200,Request URL</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Retrieve List</td>
<td style="text-align: left;">cellctl.xxx.list</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">200,Request URL</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Update</td>
<td style="text-align: left;">cellctl.xxx.update</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">204,Updated Key string</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Delete</td>
<td style="text-align: left;">cellctl.xxx.delete</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">204</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Linking with other objects</td>
<td style="text-align: left;">Link</td>
<td style="text-align: left;">cellctl.xxx.links.yyy.create</td>
<td style="text-align: left;">URL with key string</td>
<td style="text-align: left;">204</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Unlink</td>
<td style="text-align: left;">cellctl.xxx.links.yyy.delete</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">204</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">List Links</td>
<td style="text-align: left;">cellctl.xxx.links.yyy.list</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">200,Request URL</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bound Object Manipulation</td>
<td style="text-align: left;">Create</td>
<td style="text-align: left;">cellctl.xxx.navprop.yyy.create</td>
<td style="text-align: left;">URL with key string</td>
<td style="text-align: left;">201,Request URL</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Retrieve List</td>
<td style="text-align: left;">cellctl.xxx.navprop.yyy.list</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">200,Request URL</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p>xxx or yyy is the Cell Control Object Name below.</p>
<ul>
<li>Account</li>
<li>Role</li>
<li>ExtCell</li>
<li>Relation</li>
<li>ExtRole</li>
<li>Box</li>
<li>SentMessage</li>
<li>ReceivedMessage</li>
<li>Rule</li>
</ul>
<h5>Install Box</h5>
<table style="width:28%;">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">State</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Object</th>
<th style="text-align: left;">Info</th>
<th style="text-align: left;">Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Box installation reception</td>
<td style="text-align: left;">boxinstall</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">Response Code</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Box installation process in progress</td>
<td style="text-align: left;">PL-BI-1000</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">Bar installation started.</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">PL-BI-1001</td>
<td style="text-align: left;">Entry path in bar file</td>
<td style="text-align: left;">Installation started.</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">PL-BI-1003</td>
<td style="text-align: left;">Entry path in bar file</td>
<td style="text-align: left;">Installation completed.</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">PL-BI-1004</td>
<td style="text-align: left;">Entry path in bar file</td>
<td style="text-align: left;">Installation failed({cause}).</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">PL-BI-1005</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Unknown error({cause}).</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Box Installation Complete</td>
<td style="text-align: left;">PL-BI-0000</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">Bar installation completed.</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">PL-BI-0001</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">Bar installation failed({cause}).</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p>On box installation, operations abount Cell Control object is executed.</p>
<table style="width:33%;">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Operations</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Object</th>
<th style="text-align: left;">Info</th>
<th style="text-align: left;">Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Basic Operations</td>
<td style="text-align: left;">Create</td>
<td style="text-align: left;">cellctl.xxx.create</td>
<td style="text-align: left;">URL with key string</td>
<td style="text-align: left;">box install</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Linking with other objects</td>
<td style="text-align: left;">Link</td>
<td style="text-align: left;">cellctl.xxx.links.yyy.create</td>
<td style="text-align: left;">URL with key string</td>
<td style="text-align: left;">box install</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h5>Message Exchange between Cells</h5>
<table style="width:33%;">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Operations</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Object</th>
<th style="text-align: left;">Info</th>
<th style="text-align: left;">Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Send a message</td>
<td style="text-align: left;">Send message</td>
<td style="text-align: left;">message.send</td>
<td style="text-align: left;">URL to retrieve SentMessage</td>
<td style="text-align: left;">201</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Receive message</td>
<td style="text-align: left;">message.receive</td>
<td style="text-align: left;">URL to retrieve ReceivedMessage</td>
<td style="text-align: left;">201</td>
<td style="text-align: left;">Event is created on the Cell that revieves message</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Change Status</td>
<td style="text-align: left;">Read</td>
<td style="text-align: left;">message.read</td>
<td style="text-align: left;">URL to retrieve ReceivedMessage</td>
<td style="text-align: left;">204</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Unread</td>
<td style="text-align: left;">message.unread</td>
<td style="text-align: left;">URL to retrieve ReceivedMessage</td>
<td style="text-align: left;">204</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Approve</td>
<td style="text-align: left;">message.approve</td>
<td style="text-align: left;">URL to retrieve ReceivedMessage</td>
<td style="text-align: left;">204</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Reject</td>
<td style="text-align: left;">message.reject</td>
<td style="text-align: left;">URL to retrieve ReceivedMessage</td>
<td style="text-align: left;">204</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p>Examples of URL to retrieve SentMessage and URL to retrieve ReceivedMessage are as follows.</p>
<table style="width:11%;">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">URL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">URL to retrieve SentMessage</td>
<td style="text-align: left;">personium-localcell:/__ctl/SentMessage(’12345’)</td>
</tr>
<tr class="even">
<td style="text-align: left;">URL to retrieve ReceivedMessage</td>
<td style="text-align: left;">personium-localcell:/__ctl/ReceivedMessage(’12345’)</td>
</tr>
</tbody>
</table>
<p>On message approval, operations abount Cell Control object is executed.</p>
<table style="width:33%;">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Operations</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Object</th>
<th style="text-align: left;">Info</th>
<th style="text-align: left;">Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Basic Operations</td>
<td style="text-align: left;">Create</td>
<td style="text-align: left;">cellctl.ExtCell.create</td>
<td style="text-align: left;">URL with key string</td>
<td style="text-align: left;">approved for message 12345</td>
<td style="text-align: left;">12345 is __id of the message</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Create</td>
<td style="text-align: left;">cellctl.Rule.create</td>
<td style="text-align: left;">URL with key string</td>
<td style="text-align: left;">approved for message 12345</td>
<td style="text-align: left;">12345 is __id of the message</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Delete</td>
<td style="text-align: left;">cellctl.Rule.delete</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">approved for message 12345</td>
<td style="text-align: left;">12345 is __id of the message</td>
</tr>
<tr class="even">
<td style="text-align: left;">Linking with other objects</td>
<td style="text-align: left;">Link</td>
<td style="text-align: left;">cellctl.ExtCell.links.Relation.create</td>
<td style="text-align: left;">URL with key string</td>
<td style="text-align: left;">approved for message 12345</td>
<td style="text-align: left;">12345 is __id of the message</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Link</td>
<td style="text-align: left;">cellctl.ExtCell.links.Role.create</td>
<td style="text-align: left;">URL with key string</td>
<td style="text-align: left;">approved for message 12345</td>
<td style="text-align: left;">12345 is __id of the message</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Unlink</td>
<td style="text-align: left;">cellctl.ExtCell.links.Relation.delete</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">approved for message 12345</td>
<td style="text-align: left;">12345 is __id of the message</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Unlink</td>
<td style="text-align: left;">cellctl.ExtCell.links.Role.delete</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">approved for message 12345</td>
<td style="text-align: left;">12345 is __id of the message</td>
</tr>
</tbody>
</table>
<h5>Other functions</h5>
<table>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Operations</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Object</th>
<th style="text-align: left;">Info</th>
<th style="text-align: left;">Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Export</td>
<td style="text-align: left;">Execute</td>
<td style="text-align: left;">cell.export</td>
<td style="text-align: left;">personium-localcell:/__export</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Import</td>
<td style="text-align: left;">Execute</td>
<td style="text-align: left;">cell.import</td>
<td style="text-align: left;">personium-localcell:/__import</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h4>Box Level API</h4>
<h5>Basic WebDAV Operations</h5>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Target</th>
<th style="text-align: left;">Operations</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Object</th>
<th style="text-align: left;">Info</th>
<th style="text-align: left;">Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">File</td>
<td style="text-align: left;">Create/Update</td>
<td style="text-align: left;">davfile.update</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">204</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Retrieve</td>
<td style="text-align: left;">davfile.get</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">200</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Delete</td>
<td style="text-align: left;">davfile.delete</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">204</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h5>OData Service Collection</h5>
<h6>Data Manipulation</h6>
<table style="width:33%;">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Operations</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Object</th>
<th style="text-align: left;">Info</th>
<th style="text-align: left;">Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Basic Operations</td>
<td style="text-align: left;">Create</td>
<td style="text-align: left;">odata.create</td>
<td style="text-align: left;">URL with key string</td>
<td style="text-align: left;">201,Request URL</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Retrieve</td>
<td style="text-align: left;">odata.get</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">200,Request URL</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Retrieve List</td>
<td style="text-align: left;">odata.list</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">200,Request URL</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Update</td>
<td style="text-align: left;">odata.update</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">204,Updated key string</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Partial Update</td>
<td style="text-align: left;">odata.patch</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">204,Updated key string</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Delete</td>
<td style="text-align: left;">odata.delete</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">204</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Linking with other objects</td>
<td style="text-align: left;">Link</td>
<td style="text-align: left;">odata.links.create</td>
<td style="text-align: left;">URL with key string</td>
<td style="text-align: left;">204</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Unlink</td>
<td style="text-align: left;">odata.links.delete</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">204</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">List Links</td>
<td style="text-align: left;">odata.links.list</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">200,Request URL</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Bound Object Manipulation</td>
<td style="text-align: left;">Create</td>
<td style="text-align: left;">odata.navprop.create</td>
<td style="text-align: left;">URL with key string</td>
<td style="text-align: left;">201,Request URL</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Retrieve List</td>
<td style="text-align: left;">odata.navprop.list</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">200,Request URL</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h6>Schema Definition</h6>
<table style="width:33%;">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Operations</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Object</th>
<th style="text-align: left;">Info</th>
<th style="text-align: left;">Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Basic Operations</td>
<td style="text-align: left;">Create</td>
<td style="text-align: left;">odata.xxx.create</td>
<td style="text-align: left;">URL with key string</td>
<td style="text-align: left;">201,Request URL</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Retrieve</td>
<td style="text-align: left;">odata.xxx.get</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">200,Request URL</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Retrieve List</td>
<td style="text-align: left;">odata.xxx.list</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">200,Request URL</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Update</td>
<td style="text-align: left;">odata.xxx.update</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">204,Updated key string</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Partial Update</td>
<td style="text-align: left;">odata.xxx.patch</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">204,Updated key string</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Delete</td>
<td style="text-align: left;">odata.xxx.delete</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">204</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Linking with other objects</td>
<td style="text-align: left;">Link</td>
<td style="text-align: left;">odata.xxx.links.yyy.create</td>
<td style="text-align: left;">URL with key string</td>
<td style="text-align: left;">204</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Unlink</td>
<td style="text-align: left;">odata.xxx.links.yyy.delete</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">204</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">List Links</td>
<td style="text-align: left;">odata.xxx.links.yyy.list</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">200,Request URL</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p>xxx or yyy is the Schema Definition EntitySet Name.</p>
<h5>Engine Service Collection</h5>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Operations</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Object</th>
<th style="text-align: left;">Info</th>
<th style="text-align: left;">Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Service Execute</td>
<td style="text-align: left;">service.exec</td>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">Response Code</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h2>Processing events</h2>
<p>It is judged whether or not the event outputted to the event bus matches the condition of the <a href="2A0_Create_Rule.html">rule</a>, and if it matches, the action described in the rule is executed. For the action, you can specify:</p>
<ul>
<li>Log output</li>
<li>Script execution</li>
<li>Relay</li>
<li>Event relay</li>
</ul>
<h3>Matching with Rule</h3>
<p>Event matches with the rule if all items are true.</p>
<table style="width:22%;">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Event</th>
<th style="text-align: left;">Rule</th>
<th style="text-align: left;">method of judge</th>
<th style="text-align: left;">Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Subject</td>
<td style="text-align: left;">EventSubject</td>
<td style="text-align: left;">perfect matching</td>
<td style="text-align: left;">If EventSubject is null, the matching result is true.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Schema</td>
<td style="text-align: left;">Schema of Box naming with _Box.Name</td>
<td style="text-align: left;">perfect matching</td>
<td style="text-align: left;">If _Box.Name is null, the matching result is true.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RequestKey</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">It is not used in matching with the rule.</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">External</td>
<td style="text-align: left;">EventExternal</td>
<td style="text-align: left;">perfect matching</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Type</td>
<td style="text-align: left;">EventType</td>
<td style="text-align: left;">forward matching</td>
<td style="text-align: left;">If EventType is null, the matching result is true.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Object</td>
<td style="text-align: left;">EventObject</td>
<td style="text-align: left;">forward matching</td>
<td style="text-align: left;">If EventObject is null, the matching result is true.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Info</td>
<td style="text-align: left;">EventInfo</td>
<td style="text-align: left;">forward matching</td>
<td style="text-align: left;">If EventInfo is null, the matching result is true.</td>
</tr>
</tbody>
</table>
<h3>Log output Action</h3>
<p>Log output action output the event to event log file. Kinds of log output action are as follows:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Action</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">log<br>log.info</td>
<td style="text-align: left;">Output the event with INFO level.</td>
</tr>
<tr class="even">
<td style="text-align: left;">log.warn</td>
<td style="text-align: left;">Output the event with WARN level.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">log.error</td>
<td style="text-align: left;">Output the event with ERROR level.</td>
</tr>
</tbody>
</table>
<p>Event does not include log output level, Log output level is specified by Action.</p>
<h4>Rule example</h4>
<p>When Role operations were executed, output log with INFO level.</p>
<table style="width:17%;">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Item name</th>
<th style="text-align: left;">Value</th>
<th style="text-align: left;">Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">_Box.Name</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">output_cellctlRole</td>
<td style="text-align: left;">Not required.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EventType</td>
<td style="text-align: left;">cellctl.Role.</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">EventSubject</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">EventObject</td>
<td style="text-align: left;">personium-localcell:/__ctl/Role</td>
<td style="text-align: left;">Have the same effect as EventType.</td>
</tr>
<tr class="even">
<td style="text-align: left;">EventInfo</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">EventExternal</td>
<td style="text-align: left;">false</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Action</td>
<td style="text-align: left;">log</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">TargetUrl</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h4>Event log format</h4>
<p>The output format is as follows.</p>
<pre><code>{dateTime},[{level}],{RequestKey},{External},{Schema},{Subject},{Type},{Object},{Info}</code></pre>
<h4>Event log access method</h4>
<p>Since the event log is managed on the WebDAV, access to the event log file is done with the API for WebDAV.</p>
<ul>
<li><a href="284_Retrieve_Log_File_list.html">Get log file list</a></li>
<li><a href="285_Retrieve_Log_File.html">Get log file</a></li>
<li><a href="286_Delete_Log_File.html">Delete Log File</a></li>
</ul>
<h4>Event log retention period</h4>
<p>Since the size of the event log file increases according to the event amount, the event log file is rotated by a fixed amount. The number of generation generations of the rotated event log file is 12 generations maximum. The maximum size at rotation is set to 50 MB by default, and it can be set by the log setting update API.</p>
<h4>Output example</h4>
<h5>External event output example</h5>
<pre><code>2013-04-18T14:52:39.778Z,[ERROR],&quot;Req_animal-access_1001&quot;,&quot;true&quot;,
&quot;https://{UnitFQDN}/appCell/&quot;,&quot;https://{UnitFQDN}/servicemanager/#admin&quot;,&quot;actionData&quot;,
&quot;/svc/token_keeper&quot;,&quot;resultData&quot;
2013-04-18T14:52:40.688Z,[INFO ],&quot;Req_animal-access_2001&quot;,&quot;true&quot;,
&quot;https://{UnitFQDN}/appCell/&quot;,&quot;https://{UnitFQDN}/servicemanager/#admin&quot;,&quot;action&quot;,
&quot;/svc/token_keeper&quot;,&quot;result&quot;
2013-04-18T15:01:46.994Z,[INFO ],&quot;Req_animal-access_2001&quot;,&quot;true&quot;,
&quot;https://{UnitFQDN}/appCell/&quot;,&quot;https://{UnitFQDN}/servicemanager/#admin&quot;,&quot;action&quot;,
&quot;/svc/token_keeper&quot;,&quot;result&quot;
2013-04-18T15:06:19.294Z,[ERROR],&quot;Req_animal-access_1001&quot;,&quot;true&quot;,
&quot;https://{UnitFQDN}/appCell/&quot;,&quot;https://{UnitFQDN}/servicemanager/#admin&quot;,&quot;actionData&quot;,
&quot;/svc/token_keeper&quot;,&quot;resultData&quot;
2013-04-18T15:06:23.360Z,[INFO ],&quot;Req_animal-access_2001&quot;,&quot;true&quot;,
&quot;https://{UnitFQDN}/appCell/&quot;,&quot;https://{UnitFQDN}/servicemanager/#admin&quot;,&quot;action&quot;,
&quot;/svc/token_keeper&quot;,&quot;result&quot;
2013-04-18T15:09:18.073Z,[ERROR],&quot;Req_animal-access_1001&quot;,&quot;true&quot;,
&quot;https://{UnitFQDN}/appCell/&quot;,&quot;https://{UnitFQDN}/servicemanager/#admin&quot;,&quot;actionData&quot;,
&quot;/svc/token_keeper&quot;,&quot;resultData&quot;</code></pre>
<h5>Example of internal event output</h5>
<pre><code>2013-04-18T14:52:39.779Z,[INFO ],&quot;Req_animal-access_1001&quot;,&quot;false&quot;,
&quot;https://{UnitFQDN}/appCell/&quot;,&quot;https://{UnitFQDN}/appCell/#staff&quot;,&quot;odata.update&quot;,
&quot;https://{UnitFQDN}/homeClinic/box/col/put_blog&quot;,&quot;204&quot;
2013-04-18T14:52:39.780Z,[INFO ],&quot;Req_animal-access_1001&quot;,&quot;false&quot;,
&quot;https://{UnitFQDN}/appCell/&quot;,&quot;https://{UnitFQDN}/appCell/#staff&quot;,&quot;odata.get&quot;,
&quot;https://{UnitFQDN}/homeClinic/box/col/blog_20130418&quot;,&quot;200&quot;</code></pre>
<h3>Script execution Action</h3>
<p>Script execution action executes an registered <a href="384_Service_Execution.html">service</a> of one's own cell. Value of Action is exec.</p>
<h4>Rule example</h4>
<p>When a message was received, execute the service set to TargetUrl.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Item name</th>
<th style="text-align: left;">Value</th>
<th style="text-align: left;">Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">_Box.Name</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">exec_messagereceive</td>
<td style="text-align: left;">Not required.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EventType</td>
<td style="text-align: left;">message.receive</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">EventSubject</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">EventObject</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">EventInfo</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">EventExternal</td>
<td style="text-align: left;">false</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Action</td>
<td style="text-align: left;">exec</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">TargetUrl</td>
<td style="text-align: left;">personium-localcell:/box/col/srv</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h4>Parameters to the service</h4>
<p>The service receives parameters by request body and request header.</p>
<table style="width:17%;">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Item name</th>
<th style="text-align: left;">Data source</th>
<th style="text-align: left;">Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Subject</td>
<td style="text-align: left;">request body</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Schema</td>
<td style="text-align: left;">request body</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">External</td>
<td style="text-align: left;">request body</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Type</td>
<td style="text-align: left;">request body</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Object</td>
<td style="text-align: left;">request body</td>
<td style="text-align: left;">It is converted to http or https scheme.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Info</td>
<td style="text-align: left;">request body</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">RequestKey</td>
<td style="text-align: left;">request header</td>
<td style="text-align: left;">The key of the header is 'x-personium-requestkey'.</td>
</tr>
</tbody>
</table>
<p>The service gets parameters from request body as follows.</p>
<pre><code>function(request) {
  var bodyAsString = request[&quot;input&quot;].readAll();
  var params = JSON.parse(bodyAsString);</code></pre>
<p>The service gets parameters from request header as follows.</p>
<pre><code>function(request) {
  var reqHeaders = request[&quot;headers&quot;];
  var requestKey = reqHeaders[&#39;x-personium-requestkey&#39;];</code></pre>
<h4>Handling token on the service</h4>
<p>Access token is set to Authorization header.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Item name</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Subject</td>
<td style="text-align: left;">Subject of the event</td>
</tr>
<tr class="even">
<td style="text-align: left;">Schema</td>
<td style="text-align: left;">Schema of the event</td>
</tr>
</tbody>
</table>
<p>Please use _p.as('client'), _p.as('serviceSubject') or password authentication like _p.as({cellUrl:xxx, userId:xxx, password:xxx}). Schema of token created by _p.as('serviceSubject') is set to schema of the box where the service is placed.</p>
<h3>Relay Action</h3>
<p>Relay action executes an registered service of other cell. Value of Action is relay.</p>
<h4>Rule example</h4>
<p>When an entity of user data was created, execute the service set to TargetUrl.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Item name</th>
<th style="text-align: left;">Value</th>
<th style="text-align: left;">Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">_Box.Name</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">relay_odatacreate</td>
<td style="text-align: left;">Not required</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EventType</td>
<td style="text-align: left;">odata.create</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">EventSubject</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">EventObject</td>
<td style="text-align: left;">personium-localcell:/box/odatacol/entity</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">EventInfo</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">EventExternal</td>
<td style="text-align: left;">false</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Action</td>
<td style="text-align: left;">relay</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">TargetUrl</td>
<td style="text-align: left;">personium-localunit:/otherCell/box/col/srv</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h4>Parameters to the service</h4>
<p>The same as Script execution action.</p>
<h4>Handling token on the service</h4>
<p>Transcell token is set to Authorization header in order to execute this service.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Item name</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Subject</td>
<td style="text-align: left;">Subject of the event</td>
</tr>
<tr class="even">
<td style="text-align: left;">Schema</td>
<td style="text-align: left;">Schema of the event</td>
</tr>
</tbody>
</table>
<p>Please use _p.as('serviceSubject') or password authentication like _p.as({cellUrl:xxx, userId:xxx, password:xxx}).</p>
<h4>Preparation</h4>
<p>Need to set exec privilege to the cell that executes the service.</p>
<h3>Event relay Action</h3>
<p>Event relay action relays the event to the accept event api of other cell. Value of Action is relay.event.</p>
<h4>Rule example</h4>
<p>When the accept event api is called and Subject matches EventSubject, relay the event to TargetUrl.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Item name</th>
<th style="text-align: left;">Value</th>
<th style="text-align: left;">Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">_Box.Name</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">relayevent_eventreceipt</td>
<td style="text-align: left;">Not required.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EventType</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">EventSubject</td>
<td style="text-align: left;">https://{FQDN}/cell/#account</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">EventObject</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">EventInfo</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">EventExternal</td>
<td style="text-align: left;">true</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Action</td>
<td style="text-align: left;">relay.event</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">TargetUrl</td>
<td style="text-align: left;">https://{FQDN}/otherCell/</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h4>Request</h4>
<h5>Request Header</h5>
<table style="width:17%;">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Header Name</th>
<th style="text-align: left;">Value</th>
<th style="text-align: left;">Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">X-Personium-RequestKey</td>
<td style="text-align: left;">RequestKey of the event</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Authorization</td>
<td style="text-align: left;">Transcell token<br>Subject and Schema of the event are set<br>Role list when the event was occurred is set</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h5>Request Body</h5>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Item name</th>
<th style="text-align: left;">Value</th>
<th style="text-align: left;">Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Type</td>
<td style="text-align: left;">Converted value below</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Object</td>
<td style="text-align: left;">Object of the event</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Info</td>
<td style="text-align: left;">Info of the event</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p>Type conversion</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">External</th>
<th style="text-align: left;">Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">true</td>
<td style="text-align: left;">Insert 'relay.ext.' at the beginning.</td>
</tr>
<tr class="even">
<td style="text-align: left;">false</td>
<td style="text-align: left;">Insert 'relay.' at the beginning.</td>
</tr>
</tbody>
</table>
<p>If Type starts with 'relay.', type conversion is not done.</p>
<h4>Examples of relay event</h4>
<p>From CellA to CellC via CellB.</p>
<h5>In case of internal event</h5>
<h6>Rules</h6>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Item name</th>
<th style="text-align: left;">CellA</th>
<th style="text-align: left;">CellB</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">_Box.Name</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;">null</td>
</tr>
<tr class="even">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">relayevent</td>
<td style="text-align: left;">relayevent</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EventType</td>
<td style="text-align: left;">cellctl</td>
<td style="text-align: left;">null</td>
</tr>
<tr class="even">
<td style="text-align: left;">EventSubject</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;">https://hosta/CellA/#account</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EventObject</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;">null</td>
</tr>
<tr class="even">
<td style="text-align: left;">EventInfo</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;">null</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EventExternal</td>
<td style="text-align: left;">false</td>
<td style="text-align: left;">true</td>
</tr>
<tr class="even">
<td style="text-align: left;">Action</td>
<td style="text-align: left;">relay.event</td>
<td style="text-align: left;">relay.event</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TargetUrl</td>
<td style="text-align: left;">https://hostb/CellB/</td>
<td style="text-align: left;">https://hostc/CellC/</td>
</tr>
</tbody>
</table>
<h6>Relayed event flow</h6>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Item name</th>
<th style="text-align: left;">CellA</th>
<th style="text-align: left;">CellB</th>
<th style="text-align: left;">CellC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Subject</td>
<td style="text-align: left;">https://hosta/CellA/#account</td>
<td style="text-align: left;">&lt;-</td>
<td style="text-align: left;">&lt;-</td>
</tr>
<tr class="even">
<td style="text-align: left;">Schema</td>
<td style="text-align: left;">https://host/AppCell/</td>
<td style="text-align: left;">&lt;-</td>
<td style="text-align: left;">&lt;-</td>
</tr>
<tr class="odd">
<td style="text-align: left;">External</td>
<td style="text-align: left;">false</td>
<td style="text-align: left;">true</td>
<td style="text-align: left;">true</td>
</tr>
<tr class="even">
<td style="text-align: left;">Type</td>
<td style="text-align: left;">cellctl.Role.create</td>
<td style="text-align: left;">relay.cellctl.Role.create</td>
<td style="text-align: left;">&lt;-</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Object</td>
<td style="text-align: left;">https://hosta/CellA/__ctl/Role('role')</td>
<td style="text-align: left;">&lt;-</td>
<td style="text-align: left;">&lt;-</td>
</tr>
<tr class="even">
<td style="text-align: left;">Info</td>
<td style="text-align: left;">201,https://hosta/CellA/__ctl/Role</td>
<td style="text-align: left;">&lt;-</td>
<td style="text-align: left;">&lt;-</td>
</tr>
</tbody>
</table>
<h5>In case of external event</h5>
<h6>Rules</h6>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Item name</th>
<th style="text-align: left;">CellA</th>
<th style="text-align: left;">CellB</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">_Box.Name</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;">BoxB</td>
</tr>
<tr class="even">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">relayevent</td>
<td style="text-align: left;">relayevent</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EventType</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;">null</td>
</tr>
<tr class="even">
<td style="text-align: left;">EventSubject</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;">https://hosta/CellA/#account</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EventObject</td>
<td style="text-align: left;">object</td>
<td style="text-align: left;">null</td>
</tr>
<tr class="even">
<td style="text-align: left;">EventInfo</td>
<td style="text-align: left;">null</td>
<td style="text-align: left;">null</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EventExternal</td>
<td style="text-align: left;">true</td>
<td style="text-align: left;">true</td>
</tr>
<tr class="even">
<td style="text-align: left;">Action</td>
<td style="text-align: left;">relay.event</td>
<td style="text-align: left;">relay.event</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TargetUrl</td>
<td style="text-align: left;">https://hostb/CellB/</td>
<td style="text-align: left;">https://hostc/CellC/</td>
</tr>
</tbody>
</table>
<p>Schema of BoxB of CellB is https://host/AppCell/.</p>
<h6>Relayed event flow</h6>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Item name</th>
<th style="text-align: left;">CellA</th>
<th style="text-align: left;">CellB</th>
<th style="text-align: left;">CellC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Subject</td>
<td style="text-align: left;">https://hosta/CellA/#account</td>
<td style="text-align: left;">&lt;-</td>
<td style="text-align: left;">&lt;-</td>
</tr>
<tr class="even">
<td style="text-align: left;">Schema</td>
<td style="text-align: left;">https://hostb/AppCell/</td>
<td style="text-align: left;">&lt;-</td>
<td style="text-align: left;">&lt;-</td>
</tr>
<tr class="odd">
<td style="text-align: left;">External</td>
<td style="text-align: left;">true</td>
<td style="text-align: left;">true</td>
<td style="text-align: left;">true</td>
</tr>
<tr class="even">
<td style="text-align: left;">Type</td>
<td style="text-align: left;">type</td>
<td style="text-align: left;">relay.ext.type</td>
<td style="text-align: left;">&lt;-</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Object</td>
<td style="text-align: left;">object</td>
<td style="text-align: left;">&lt;-</td>
<td style="text-align: left;">&lt;-</td>
</tr>
<tr class="even">
<td style="text-align: left;">Info</td>
<td style="text-align: left;">info</td>
<td style="text-align: left;">&lt;-</td>
<td style="text-align: left;">&lt;-</td>
</tr>
</tbody>
</table>
<h4>Preparation</h4>
<p>Need to set event privilege to the cell that calls the accept event api.</p>
</div>
  <footer><nav>The Personium project is provided under the Apache 2.0 license. </nav></footer>
</body>
</html>
