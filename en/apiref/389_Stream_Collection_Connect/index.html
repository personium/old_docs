<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Web Socket connection to Stream Collection · </title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Overview"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Web Socket connection to Stream Collection · "/><meta property="og:type" content="website"/><meta property="og:url" content="https://personium.github.io/"/><meta property="og:description" content="## Overview"/><meta property="og:image" content="https://personium.github.io/images/header-icon.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://personium.github.io/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/images/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://personium.github.io/blog/atom.xml" title=" Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://personium.github.io/blog/feed.xml" title=" Blog RSS Feed"/><link rel="stylesheet" href="/docusaurus_css/custom.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo-quantify-light.png" alt=""/><h2 class="headerTitleWithLogo"></h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://personium.io/docs/en/overview/001_Introduction.html" target="_self">Introduction</a></li><li class=""><a href="https://personium.io/docs/en" target="_self">User Guide</a></li><li class=""><a href="https://personium.io/docs/en/apiref/current/000_Rest_API_Reference.html" target="_self">API Reference</a></li><li class=""><a href="/blog/" target="_self">News</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Web Socket connection to Stream Collection</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="overview"></a><a href="#overview" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview</h2>
<p>You can receive the data sent to the topic of Stream Collection in real time.<br>
This API first requests transmission of an access token. Allows connection only when the corresponding token has topic receive authority.</p>
<h3><a class="anchor" aria-hidden="true" id="required-privileges"></a><a href="#required-privileges" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Required Privileges</h3>
<ul>
<li>read : For confirmation of the existence of topic</li>
<li>stream-receive : To receive data from topic</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="connection-and-session-start"></a><a href="#connection-and-session-start" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Connection and session start</h2>
<h3><a class="anchor" aria-hidden="true" id="connection-endpoint-url"></a><a href="#connection-endpoint-url" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Connection endpoint URL</h3>
<pre><code class="hljs"><span class="xml">    wss://</span><span class="hljs-template-variable">{CellName}</span><span class="xml">.</span><span class="hljs-template-variable">{UnitFQDN}</span><span class="xml">/__topic/</span><span class="hljs-template-variable">{BoxName}</span><span class="xml">/</span><span class="hljs-template-variable">{Path}</span><span class="xml">
</span></code></pre>
<p>or</p>
<pre><code class="hljs"><span class="xml">    wss://</span><span class="hljs-template-variable">{UnitFQDN}</span><span class="xml">/</span><span class="hljs-template-variable">{CellName}</span><span class="xml">/__topic/</span><span class="hljs-template-variable">{BoxName}</span><span class="xml">/</span><span class="hljs-template-variable">{Path}</span><span class="xml">
</span></code></pre>
<p>{Path} specifies the path when sending Stream Collection, excluding {CellName} and {BoxName}, and changing &quot;/&quot; to &quot;.&quot;.<br>
For example, the URL when sending</p>
<pre><code class="hljs">    https:<span class="hljs-regexp">//</span>cell1.unit1.example<span class="hljs-regexp">/box1/</span>stream-collection1<span class="hljs-regexp">/topic/</span>name
</code></pre>
<p>when the WebSocket connection is</p>
<pre><code class="hljs"><span class="hljs-symbol">    wss:</span><span class="hljs-comment">//cell1.unit1.example/__topic/box1/stream-collection1.topic.name</span>
</code></pre>
<p>it becomes.</p>
<p>First, please connect to the above URL by WebSocket. It will be in the state which accepts an access token. In this state, sending any message other than sending access token has no meaning.</p>
<h3><a class="anchor" aria-hidden="true" id="session-start-by-sending-access-token"></a><a href="#session-start-by-sending-access-token" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Session start by sending access token</h3>
<h4><a class="anchor" aria-hidden="true" id="request-message"></a><a href="#request-message" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Request message</h4>
<p>Start an event bus connection session by sending an authorized access token in the following format.</p>
<pre><code class="hljs">{&quot;AccessToken&quot;:&quot;AA~91WT0GNoVGFHJFQ.......e&quot;}
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="response-message"></a><a href="#response-message" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Response message</h4>
<p>If it is a valid token, the following response is returned, and the session will be started.</p>
<pre><code class="hljs">{&quot;Response&quot;:&quot;AccessToken&quot;, &quot;Result&quot;:&quot;Success&quot;, &quot;ExpiresIn&quot;:3600, &quot;Timestamp&quot;:1518612600}
</code></pre>
<p>If the token is invalid or the token does not have the required authority, the following response is returned, and the WebSocket connection is disconnected.</p>
<pre><code class="hljs">{&quot;Response&quot;:&quot;AccessToken&quot;, &quot;Result&quot;:&quot;Error&quot;, &quot;Reason&quot;:&quot;Token inactive&quot;, &quot;Timestamp&quot;:1518612600}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="communication-after-session-start"></a><a href="#communication-after-session-start" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Communication after session start</h2>
<p>After the session is established, the client can send the following command as a request message.</p>
<ul>
<li>Retransmission of access token</li>
</ul>
<p>You can extend the session expiration date by sending a new access token with the access token send command.</p>
<p>As soon as you send the request message, the response message will be returned.
If there is a problem with the request message, an error response message will be returned and the WebSocket connection will be disconnected.</p>
<h2><a class="anchor" aria-hidden="true" id="receive-data"></a><a href="#receive-data" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Receive data</h2>
<p>When data is sent to topic, data in JSON format is sent to the client.</p>
<pre><code class="hljs">{
  &quot;From&quot;:&quot;{CellURL}&quot;, 
  &quot;Body&quot;:{data}
}
</code></pre>
<p>In From, CellURL of Cell which sent data to topic is set. The sent data is set to Body.<br>
For example,</p>
<pre><code class="hljs">{<span class="hljs-attr">"hoge"</span>:<span class="hljs-string">"testmessage"</span>, <span class="hljs-attr">"flag"</span>:<span class="hljs-literal">true</span>}
</code></pre>
<p>is sent from cell1 (https: //cell1.unit1.example/),</p>
<pre><code class="hljs">{<span class="hljs-attr">"From"</span>:<span class="hljs-string">"https://cell1.unit1.example/"</span>, <span class="hljs-attr">"Body"</span>:{<span class="hljs-attr">"hoge"</span>:<span class="hljs-string">"testmessage"</span>, <span class="hljs-attr">"flag"</span>:<span class="hljs-literal">true</span>}}
</code></pre>
<p>receive.</p>
<h2><a class="anchor" aria-hidden="true" id="error-response-message"></a><a href="#error-response-message" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Error response message</h2>
<pre><code class="hljs">{&quot;Response&quot;: &quot;${CorrespondingRequest}&quot;, &quot;Result&quot;:&quot;Error&quot;, &quot;Reason&quot;: &quot;${ErrorMessage}&quot;}
</code></pre>
<table>
<thead>
<tr><th style="text-align:left">Error Message</th><th style="text-align:left">Description</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left">Invalid message</td><td style="text-align:left">When the request message is invalid</td></tr>
<tr><td style="text-align:left">Token inactive</td><td style="text-align:left">When the token is invalid</td></tr>
<tr><td style="text-align:left">Session expired</td><td style="text-align:left">When the token has expired. Response is returned only at the time of request. CorrespondingRequest will be Unknown.</td></tr>
</tbody>
</table>
<h2><a class="anchor" aria-hidden="true" id="web-socket-spec-details"></a><a href="#web-socket-spec-details" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Web Socket Spec Details</h2>
<table>
<thead>
<tr><th style="text-align:left">Item</th><th style="text-align:left">Spec</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left">Protocol</td><td style="text-align:left">Sec-WebSocket-Version 13(RFC 6455)</td></tr>
<tr><td style="text-align:left">Message format</td><td style="text-align:left">JSON</td></tr>
<tr><td style="text-align:left">ping/pong</td><td style="text-align:left">&quot;ping&quot; will be sent from the Cell every one minutes.</td></tr>
</tbody>
</table>
<ul>
<li>Connection will be closed if client fails to respond &quot;pong&quot; against the &quot;ping&quot; from the Cell 10 times.</li>
<li>Major Web Browsers automatically responds &quot;pong&quot; in their WebSocket client implementations.</li>
</ul>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#overview">Overview</a><ul class="toc-headings"><li><a href="#required-privileges">Required Privileges</a></li></ul></li><li><a href="#connection-and-session-start">Connection and session start</a><ul class="toc-headings"><li><a href="#connection-endpoint-url">Connection endpoint URL</a></li><li><a href="#session-start-by-sending-access-token">Session start by sending access token</a></li></ul></li><li><a href="#communication-after-session-start">Communication after session start</a></li><li><a href="#receive-data">Receive data</a></li><li><a href="#error-response-message">Error response message</a></li><li><a href="#web-socket-spec-details">Web Socket Spec Details</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/images/favicon.ico" alt="" width="66" height="58"/></a><div><h5>Documentation</h5><a href="https://personium.io/docs/en/overview/001_Introduction.html">Introduction</a><a href="https://personium.io/docs/en/server-operator/">Server Software Operator&#x27;s Guide</a><a href="https://personium.io/docs/en/app-developer/">Application Developer&#x27;s Guide</a><a href="https://personium.io/docs/en/apiref/current/000_Rest_API_Reference.html">API Reference</a></div><div><h5>Community</h5><a href="https://personium-io.slack.com/">Slack</a><a href="https://github.com/personium">GitHub</a><a href="https://twitter.com/personium" target="_blank" rel="noreferrer noopener">Twitter</a><div class="social"><a href="https://twitter.com/personium" class="twitter-follow-button">Follow @personium</a></div></div><div><h5>More</h5><a href="/blog">News</a><a href="https://drive.google.com/drive/u/1/folders/1VWGpfCbPOLY2TCa7Lh2jbcsZ5Bp0WV4q">Draft Docs</a></div></section><a href="https://personium.io/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/logo-quantify-light.png" alt="Personium Project" width="170" height="45"/></a><section class="copyright">Copyright © 2019 Personium Project</section></footer></div><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script></body></html>